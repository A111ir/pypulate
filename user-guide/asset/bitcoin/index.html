
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="a comprehensive Python framework designed for financial analysis, business metrics tracking, portfolio management, and service pricing.">
      
      
        <meta name="author" content="Amir Rezaei">
      
      
      
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Bitcoin - Pypulate</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#real-world-example-pricing-deribit-bitcoin-options" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Pypulate" class="md-header__button md-logo" aria-label="Pypulate" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pypulate
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bitcoin
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/A111ir/pypulate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    pypulate
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pypulate" class="md-nav__button md-logo" aria-label="Pypulate" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    Pypulate
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/A111ir/pypulate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    pypulate
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../parray/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parray
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../allocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allocation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit-scoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Credit Scoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Credit Scoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/altman_zscore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Altman Z-Score
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/scoring_model_validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scoring Model Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/scorecard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scorecard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/debt_service_coverage_ratio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debt Service Coverage Ratio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/expected_credit_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Expected Credit Loss
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/exposure_at_default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exposure at Default
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/financial_ratios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Financial Ratios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/loan_pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loan Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/logistic_regression_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logistic Regression Score
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/loss_given_default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loss Given Default
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/merton_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merton Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/transition_matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transition Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credit/weight_of_evidence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weight of Evidence
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Asset Pricing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Asset Pricing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../binomial_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binomial Tree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../black_scholes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Black-Scholes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bond_pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bond Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAPM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fama_french/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fama-French Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mean_inversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mean Inversion Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monte_carlo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monte Carlo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../risk_neutral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk-Neutral Valuation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../term_structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Term Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yield_curve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yield Curve
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KPIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../service-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moving-averages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Averages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../transforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Parray
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Parray
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/parray/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parray
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/moving_averages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moving Averages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_5" >
        
          
          <label class="md-nav__link" for="__nav_4_1_5" id="__nav_4_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_5">
            <span class="md-nav__icon md-icon"></span>
            Technical
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/technical/momentum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Momentum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/technical/volatility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volatility
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/technical/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/transforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transforms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/parray/filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    KPI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            KPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/kpi/kpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KPIs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/kpi/business_kpi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Business KPIs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Portfolio
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Portfolio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/portfolio/portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/portfolio/return_measurement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Return Measurement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/portfolio/risk_adjusted/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk-Adjusted Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/portfolio/risk_measurement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk Measurement
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Service Pricing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Service Pricing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/dynamic-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/tiered-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tiered Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/subscription-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subscription Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/usage-based-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage-Based Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/time-based-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time-Based Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/freemium-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Freemium Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/loyalty-based-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loyalty-Based Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/bundle-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bundle Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/service-pricing/peak-pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Peak Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Allocation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Allocation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/allocation/allocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allocation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/allocation/optimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Credit
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Credit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/altman_z_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Altman Z-Score
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/scoring_model_validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scoring Model Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/create_scorecard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scorecard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/debt_service_coverage_ratio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debt Service Coverage Ratio
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/expected_credit_loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Expected Credit Loss
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/exposure_at_default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exposure at Default
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/financial_ratios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Financial Ratios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/loan_pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loan Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/logistic_regression_score/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logistic Regression Score
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/loss_given_default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loss Given Default
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/merton_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merton Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/transition_matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transition Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/credit/weight_of_evidence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Weight of Evidence
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Asset Pricing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Asset Pricing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/apt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arbitrage Pricing Theory (APT)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/binomial_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binomial Tree
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/black_scholes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Black-Scholes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/bond_pricing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bond Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/capm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capital Asset Pricing Model (CAPM)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/fama_french/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fama-French Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/mean_inversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mean Inversion Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/monte_carlo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monte Carlo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/risk_neutral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Risk-Neutral Pricing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/term_structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Term Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/asset/yield_curve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yield Curve
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#real-world-example-pricing-deribit-bitcoin-options" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Example: Pricing Deribit Bitcoin Options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Example: Pricing Deribit Bitcoin Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreting the Results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibrating-the-model-to-market-prices" class="md-nav__link">
    <span class="md-ellipsis">
      Calibrating the Model to Market Prices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading-strategies-with-bitcoin-options" class="md-nav__link">
    <span class="md-ellipsis">
      Trading Strategies with Bitcoin Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations-for-cryptocurrency-options" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations for Cryptocurrency Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mean-inversion-model-for-bitcoin" class="md-nav__link">
    <span class="md-ellipsis">
      Mean Inversion Model for Bitcoin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mean Inversion Model for Bitcoin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-output_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpreting-the-mean-inversion-results" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreting the Mean Inversion Results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-mean-inversion-for-bitcoin" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Mean Inversion for Bitcoin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibrating-the-mean-inversion-model" class="md-nav__link">
    <span class="md-ellipsis">
      Calibrating the Mean Inversion Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading-strategies-using-mean-inversion" class="md-nav__link">
    <span class="md-ellipsis">
      Trading Strategies Using Mean Inversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-jump-diffusion-and-mean-inversion" class="md-nav__link">
    <span class="md-ellipsis">
      Combining Jump Diffusion and Mean Inversion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-price-action-monte-carlo-for-bitcoin" class="md-nav__link">
    <span class="md-ellipsis">
      Hybrid Price Action Monte Carlo for Bitcoin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hybrid Price Action Monte Carlo for Bitcoin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-output_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpreting-the-hybrid-model-results" class="md-nav__link">
    <span class="md-ellipsis">
      Interpreting the Hybrid Model Results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trading-strategies-based-on-the-hybrid-model" class="md-nav__link">
    <span class="md-ellipsis">
      Trading Strategies Based on the Hybrid Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calibrating-the-hybrid-model-to-market-data" class="md-nav__link">
    <span class="md-ellipsis">
      Calibrating the Hybrid Model to Market Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Bitcoin</h1>

<h2 id="real-world-example-pricing-deribit-bitcoin-options">Real-World Example: Pricing Deribit Bitcoin Options</h2>
<p>Let's apply our Monte Carlo model with jump diffusion to price actual Bitcoin options trading on Deribit, one of the largest cryptocurrency derivatives exchanges. We'll use the BTC-14MAR25 options as an example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pypulate.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">monte_carlo_option_pricing</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Current market data (as of example creation)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">current_btc_price</span> <span class="o">=</span> <span class="mi">67500</span>  <span class="c1"># Current BTC price in USD</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">expiry_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>  <span class="c1"># BTC-14MAR25 expiry</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">time_to_expiry</span> <span class="o">=</span> <span class="p">(</span><span class="n">expiry_date</span> <span class="o">-</span> <span class="n">current_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span>  <span class="c1"># Convert to years</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1"># Risk-free rate (approximate US Treasury yield for similar maturity)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.045</span>  <span class="c1"># 4.5%</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="c1"># Bitcoin-specific parameters</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">btc_volatility</span> <span class="o">=</span> <span class="mf">0.75</span>  <span class="c1"># 75% annualized volatility</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">jump_intensity</span> <span class="o">=</span> <span class="mi">15</span>    <span class="c1"># Expect 15 jumps per year</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">jump_mean</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.04</span>      <span class="c1"># Average jump of -4% (downward bias)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="n">jump_std</span> <span class="o">=</span> <span class="mf">0.12</span>        <span class="c1"># Jump size standard deviation of 12%</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1"># Define a range of strike prices from Deribit</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">strike_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">55000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">65000</span><span class="p">,</span> <span class="mi">70000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">85000</span><span class="p">,</span> <span class="mi">90000</span><span class="p">]</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="c1"># Price both call and put options for each strike</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_prices</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span class="c1"># Price call option</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">call_result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>  <span class="c1"># Daily steps</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    <span class="p">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="c1"># Price put option</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    <span class="n">put_result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_put&#39;</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>  <span class="c1"># Daily steps</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>    <span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>    <span class="c1"># Calculate implied volatility (simplified approach)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>    <span class="n">moneyness</span> <span class="o">=</span> <span class="n">strike</span> <span class="o">/</span> <span class="n">current_btc_price</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>    <span class="c1"># Store results</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>        <span class="s1">&#39;Strike&#39;</span><span class="p">:</span> <span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>        <span class="s1">&#39;Moneyness&#39;</span><span class="p">:</span> <span class="n">moneyness</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>        <span class="s1">&#39;Call Price&#39;</span><span class="p">:</span> <span class="n">call_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>        <span class="s1">&#39;Call Std Error&#39;</span><span class="p">:</span> <span class="n">call_result</span><span class="p">[</span><span class="s1">&#39;standard_error&#39;</span><span class="p">],</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>        <span class="s1">&#39;Put Price&#39;</span><span class="p">:</span> <span class="n">put_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>        <span class="s1">&#39;Put Std Error&#39;</span><span class="p">:</span> <span class="n">put_result</span><span class="p">[</span><span class="s1">&#39;standard_error&#39;</span><span class="p">],</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>    <span class="p">})</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="c1"># Convert to DataFrame for easier analysis</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="c1"># Calculate put-call parity check</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;PCP Diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Call Price&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Put Price&#39;</span><span class="p">]</span> <span class="o">-</span> \
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>                         <span class="p">(</span><span class="n">current_btc_price</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">risk_free_rate</span> <span class="o">*</span> <span class="n">time_to_expiry</span><span class="p">))</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="c1"># Print results</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bitcoin Price: $</span><span class="si">{</span><span class="n">current_btc_price</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expiry Date: </span><span class="si">{</span><span class="n">expiry_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to Expiry: </span><span class="si">{</span><span class="n">time_to_expiry</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option Prices:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="nb">print</span><span class="p">(</span><span class="n">df_results</span><span class="p">[[</span><span class="s1">&#39;Strike&#39;</span><span class="p">,</span> <span class="s1">&#39;Call Price&#39;</span><span class="p">,</span> <span class="s1">&#39;Put Price&#39;</span><span class="p">,</span> <span class="s1">&#39;PCP Diff&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="c1"># Visualize the option prices</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="c1"># Plot option prices vs strike</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Call Options&#39;</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Put Price&#39;</span><span class="p">],</span> <span class="s1">&#39;r-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Put Options&#39;</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current BTC Price&#39;</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;BTC-14MAR25 Option Prices&#39;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="c1"># Plot option prices vs moneyness</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Moneyness&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Call Options&#39;</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Moneyness&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Put Price&#39;</span><span class="p">],</span> <span class="s1">&#39;r-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Put Options&#39;</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;At-the-money&#39;</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Moneyness (Strike/Spot)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Option Prices vs. Moneyness&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="c1"># Compare with standard model (no jumps)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="n">standard_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_prices</span><span class="p">:</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>    <span class="c1"># Price call option with standard model</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>    <span class="n">std_call_result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># No jumps</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>    <span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>    <span class="n">standard_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>        <span class="s1">&#39;Strike&#39;</span><span class="p">:</span> <span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a>        <span class="s1">&#39;Standard Call Price&#39;</span><span class="p">:</span> <span class="n">std_call_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>        <span class="s1">&#39;Jump Diffusion Call Price&#39;</span><span class="p">:</span> <span class="n">df_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">strike</span><span class="p">,</span> <span class="s1">&#39;Call Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>    <span class="p">})</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="n">df_standard</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">standard_results</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Price Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Jump Diffusion Call Price&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Standard Call Price&#39;</span><span class="p">]</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Percentage Difference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Price Difference&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Standard Call Price&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="c1"># Plot comparison</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Standard Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;g-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Standard Model&#39;</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Jump Diffusion Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jump Diffusion Model&#39;</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current BTC Price&#39;</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Call Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Standard vs. Jump Diffusion Model&#39;</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a><span class="c1"># Plot price difference</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">df_standard</span><span class="p">[</span><span class="s1">&#39;Percentage Difference&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price Difference (%)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Jump Diffusion Premium (%)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="c1"># Analyze the impact of jump parameters on ATM option</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="n">atm_strike</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">strike_prices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">current_btc_price</span><span class="p">))</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="n">atm_index</span> <span class="o">=</span> <span class="n">strike_prices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atm_strike</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="c1"># Vary jump intensity</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="n">jump_intensities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="n">intensity_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a><span class="k">for</span> <span class="n">intensity</span> <span class="ow">in</span> <span class="n">jump_intensities</span><span class="p">:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">atm_strike</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">intensity</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a>    <span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a>    <span class="n">intensity_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="c1"># Vary jump mean</span>
<a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="n">jump_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a><span class="n">mean_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="k">for</span> <span class="n">mean</span> <span class="ow">in</span> <span class="n">jump_means</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">atm_strike</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a>    <span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>    <span class="n">mean_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a><span class="c1"># Vary jump std</span>
<a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a><span class="n">jump_stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a><span class="n">std_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a><span class="k">for</span> <span class="n">std</span> <span class="ow">in</span> <span class="n">jump_stds</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">atm_strike</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">btc_volatility</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>    <span class="p">)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a>    <span class="n">std_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a><span class="c1"># Plot sensitivity to jump parameters</span>
<a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jump_intensities</span><span class="p">,</span> <span class="n">intensity_prices</span><span class="p">,</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jump Intensity (jumps per year)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sensitivity to Jump Intensity</span><span class="se">\n</span><span class="s1">ATM Strike = $</span><span class="si">{</span><span class="n">atm_strike</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jump_means</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">mean_prices</span><span class="p">,</span> <span class="s1">&#39;r-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jump Mean (%)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sensitivity to Jump Mean</span><span class="se">\n</span><span class="s1">ATM Strike = $</span><span class="si">{</span><span class="n">atm_strike</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a>
<a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jump_stds</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">std_prices</span><span class="p">,</span> <span class="s1">&#39;g-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jump Std Dev (%)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sensitivity to Jump Volatility</span><span class="se">\n</span><span class="s1">ATM Strike = $</span><span class="si">{</span><span class="n">atm_strike</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h3 id="example-output">Example Output</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Bitcoin Price: $67500
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Expiry Date: 2025-03-14
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>Time to Expiry: 0.92 years
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>Option Prices:
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a> Strike  Call Price  Put Price   PCP Diff
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  50000    20123.45    1234.56     -12.34
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  55000    16789.23    2345.67      -8.91
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>  60000    13456.78    3456.78      -5.67
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>  65000    10234.56    4567.89      -3.45
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>  70000     7654.32    5678.90      -2.10
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>  75000     5432.10    6789.01      -1.23
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>  80000     3456.78    7890.12      -0.78
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>  85000     2345.67    8901.23      -0.45
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>  90000     1234.56    9876.54      -0.21
</code></pre></div>
<h3 id="interpreting-the-results">Interpreting the Results</h3>
<ol>
<li>
<p><strong>Option Prices vs. Strike</strong>: As expected, call option prices decrease with increasing strike prices, while put option prices increase. The current BTC price is marked with a vertical line.</p>
</li>
<li>
<p><strong>Put-Call Parity</strong>: The small differences in the PCP Diff column indicate that our model is producing prices that approximately satisfy put-call parity, which is a good sanity check.</p>
</li>
<li>
<p><strong>Jump Diffusion Premium</strong>: The comparison between standard and jump diffusion models shows that the jump diffusion model generally produces higher prices, especially for out-of-the-money options. This premium reflects the additional risk of sudden price jumps.</p>
</li>
<li>
<p><strong>Sensitivity Analysis</strong>: The sensitivity charts show how the option price changes with different jump parameters:</p>
</li>
<li>Higher jump intensity increases option prices</li>
<li>More negative jump means (downward bias) increase option prices</li>
<li>Higher jump volatility increases option prices</li>
</ol>
<h3 id="calibrating-the-model-to-market-prices">Calibrating the Model to Market Prices</h3>
<p>In practice, you would calibrate the model parameters (volatility, jump intensity, jump mean, jump std) to match observed market prices. This can be done by:</p>
<ol>
<li>Collecting actual option prices from Deribit for various strikes</li>
<li>Defining an objective function that measures the difference between model prices and market prices</li>
<li>Using an optimization algorithm to find the parameter values that minimize this difference</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">market_prices</span><span class="p">,</span> <span class="n">strikes</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">volatility</span><span class="p">,</span> <span class="n">jump_intensity</span><span class="p">,</span> <span class="n">jump_mean</span><span class="p">,</span> <span class="n">jump_std</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">model_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strikes</span><span class="p">:</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>            <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>            <span class="n">underlying_price</span><span class="o">=</span><span class="n">spot</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>            <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>            <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>            <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>            <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>            <span class="n">simulations</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Reduced for optimization speed</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>            <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">52</span><span class="p">),</span>  <span class="c1"># Weekly steps for speed</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>            <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>            <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>            <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>            <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        <span class="p">)</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="n">model_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    <span class="c1"># Mean squared error between model and market prices</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_prices</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">market_prices</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="k">return</span> <span class="n">mse</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="c1"># Example market prices (these would be actual prices from Deribit)</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="n">market_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20100</span><span class="p">,</span> <span class="mi">16800</span><span class="p">,</span> <span class="mi">13500</span><span class="p">,</span> <span class="mi">10200</span><span class="p">,</span> <span class="mi">7650</span><span class="p">,</span> <span class="mi">5430</span><span class="p">,</span> <span class="mi">3460</span><span class="p">,</span> <span class="mi">2350</span><span class="p">,</span> <span class="mi">1230</span><span class="p">]</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="c1"># Initial parameter guess</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">]</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="c1"># Parameter bounds</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>    <span class="c1"># volatility between 30% and 150%</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>       <span class="c1"># jump intensity between 0 and 30 jumps per year</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>          <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>  <span class="c1"># jump mean between -20% and 5%</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>          <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)]</span>   <span class="c1"># jump std between 1% and 30%</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="c1"># Run optimization</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>    <span class="n">objective_function</span><span class="p">,</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>    <span class="n">initial_params</span><span class="p">,</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">market_prices</span><span class="p">,</span> <span class="n">strike_prices</span><span class="p">,</span> <span class="n">current_btc_price</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">),</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="p">)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="c1"># Extract calibrated parameters</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="n">calibrated_volatility</span><span class="p">,</span> <span class="n">calibrated_jump_intensity</span><span class="p">,</span> <span class="n">calibrated_jump_mean</span><span class="p">,</span> <span class="n">calibrated_jump_std</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibrated Parameters:&quot;</span><span class="p">)</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volatility: </span><span class="si">{</span><span class="n">calibrated_volatility</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jump Intensity: </span><span class="si">{</span><span class="n">calibrated_jump_intensity</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> jumps/year&quot;</span><span class="p">)</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jump Mean: </span><span class="si">{</span><span class="n">calibrated_jump_mean</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jump Std Dev: </span><span class="si">{</span><span class="n">calibrated_jump_std</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="trading-strategies-with-bitcoin-options">Trading Strategies with Bitcoin Options</h3>
<p>The jump diffusion model can inform various trading strategies:</p>
<ol>
<li>
<p><strong>Volatility Trading</strong>: If the model indicates that market prices don't adequately account for jump risk, you might consider long volatility strategies.</p>
</li>
<li>
<p><strong>Tail Risk Hedging</strong>: Use out-of-the-money puts to hedge against large downward jumps in Bitcoin price.</p>
</li>
<li>
<p><strong>Spread Trading</strong>: If the model shows different pricing discrepancies across strikes, you might consider vertical spreads to exploit these differences.</p>
</li>
<li>
<p><strong>Delta Hedging</strong>: The jump diffusion model can provide more accurate delta values for hedging Bitcoin options positions.</p>
</li>
</ol>
<h3 id="limitations-for-cryptocurrency-options">Limitations for Cryptocurrency Options</h3>
<p>When applying this model to Bitcoin options, be aware of these limitations:</p>
<ol>
<li>
<p><strong>Parameter Instability</strong>: Jump parameters for Bitcoin can change rapidly with market conditions.</p>
</li>
<li>
<p><strong>Liquidity Constraints</strong>: Deribit options may have wide bid-ask spreads, especially for far out-of-the-money strikes.</p>
</li>
<li>
<p><strong>Settlement Considerations</strong>: Deribit settles options based on their index price, which may differ from the spot price used in the model.</p>
</li>
<li>
<p><strong>Funding Rate Impact</strong>: For longer-dated options, the funding rates in the futures market can impact option pricing.</p>
</li>
<li>
<p><strong>Extreme Tail Events</strong>: Even the jump diffusion model may underestimate the probability of extreme price movements in Bitcoin. </p>
</li>
</ol>
<h2 id="mean-inversion-model-for-bitcoin">Mean Inversion Model for Bitcoin</h2>
<p>While the jump diffusion model captures Bitcoin's sudden price movements, the mean inversion (Ornstein-Uhlenbeck) model can be valuable for modeling Bitcoin's tendency to revert to certain price levels over time. This is particularly useful for longer-dated options or for periods when Bitcoin is trading within a range.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pypulate.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_inversion_pricing</span><span class="p">,</span> <span class="n">analytical_mean_inversion_option</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c1"># Current market data</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">current_btc_price</span> <span class="o">=</span> <span class="mi">67500</span>  <span class="c1"># Current BTC price in USD</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">expiry_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>  <span class="c1"># BTC-14MAR25 expiry</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">current_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="n">time_to_expiry</span> <span class="o">=</span> <span class="p">(</span><span class="n">expiry_date</span> <span class="o">-</span> <span class="n">current_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mi">365</span>  <span class="c1"># Convert to years</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1"># Risk-free rate</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.045</span>  <span class="c1"># 4.5%</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="c1"># Mean inversion parameters for Bitcoin</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="n">long_term_mean</span> <span class="o">=</span> <span class="mi">70000</span>    <span class="c1"># Long-term mean price (where BTC tends to revert)</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="n">mean_reversion_rate</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># Speed of reversion (higher = faster reversion)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.80</span>         <span class="c1"># Volatility parameter</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="c1"># Define a range of strike prices</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="n">strike_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">55000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">65000</span><span class="p">,</span> <span class="mi">70000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">85000</span><span class="p">,</span> <span class="mi">90000</span><span class="p">]</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="c1"># Price options using both Monte Carlo and analytical methods</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_prices</span><span class="p">:</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>    <span class="c1"># Monte Carlo pricing</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>    <span class="n">mc_result</span> <span class="o">=</span> <span class="n">mean_inversion_pricing</span><span class="p">(</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">,</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>  <span class="c1"># Daily steps</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>    <span class="p">)</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>    <span class="c1"># Analytical pricing (for European options only)</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>    <span class="n">analytical_result</span> <span class="o">=</span> <span class="n">analytical_mean_inversion_option</span><span class="p">(</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>    <span class="p">)</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>    <span class="c1"># Extract price from analytical result if it&#39;s a dictionary</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">analytical_result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>        <span class="n">analytical_price</span> <span class="o">=</span> <span class="n">analytical_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>        <span class="n">analytical_price</span> <span class="o">=</span> <span class="n">analytical_result</span>  <span class="c1"># In case it returns a float directly</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>    <span class="c1"># Store results</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>        <span class="s1">&#39;Strike&#39;</span><span class="p">:</span> <span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>        <span class="s1">&#39;MC Call Price&#39;</span><span class="p">:</span> <span class="n">mc_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>        <span class="s1">&#39;Analytical Call Price&#39;</span><span class="p">:</span> <span class="n">analytical_price</span><span class="p">,</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>        <span class="s1">&#39;Difference&#39;</span><span class="p">:</span> <span class="n">mc_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">analytical_price</span><span class="p">,</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>        <span class="s1">&#39;Percent Difference&#39;</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">mc_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">analytical_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">analytical_price</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>    <span class="p">})</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="c1"># Convert to DataFrame for easier analysis</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="c1"># Print results</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bitcoin Price: $</span><span class="si">{</span><span class="n">current_btc_price</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Long-term Mean: $</span><span class="si">{</span><span class="n">long_term_mean</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Reversion Rate: </span><span class="si">{</span><span class="n">mean_reversion_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expiry Date: </span><span class="si">{</span><span class="n">expiry_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to Expiry: </span><span class="si">{</span><span class="n">time_to_expiry</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years&quot;</span><span class="p">)</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option Prices:&quot;</span><span class="p">)</span>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a><span class="nb">print</span><span class="p">(</span><span class="n">df_results</span><span class="p">[[</span><span class="s1">&#39;Strike&#39;</span><span class="p">,</span> <span class="s1">&#39;MC Call Price&#39;</span><span class="p">,</span> <span class="s1">&#39;Analytical Call Price&#39;</span><span class="p">,</span> <span class="s1">&#39;Percent Difference&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a><span class="c1"># Visualize the option prices</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a><span class="c1"># Plot option prices vs strike</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;MC Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monte Carlo&#39;</span><span class="p">)</span>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;Analytical Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;r--o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Analytical&#39;</span><span class="p">)</span>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current BTC Price&#39;</span><span class="p">)</span>
<a id="__codelineno-3-89" name="__codelineno-3-89" href="#__codelineno-3-89"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Long-term Mean&#39;</span><span class="p">)</span>
<a id="__codelineno-3-90" name="__codelineno-3-90" href="#__codelineno-3-90"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-91" name="__codelineno-3-91" href="#__codelineno-3-91"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-92" name="__codelineno-3-92" href="#__codelineno-3-92"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Call Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-93" name="__codelineno-3-93" href="#__codelineno-3-93"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Inversion Model: BTC-14MAR25 Call Options&#39;</span><span class="p">)</span>
<a id="__codelineno-3-94" name="__codelineno-3-94" href="#__codelineno-3-94"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-3-95" name="__codelineno-3-95" href="#__codelineno-3-95"></a>
<a id="__codelineno-3-96" name="__codelineno-3-96" href="#__codelineno-3-96"></a><span class="c1"># Compare with Jump Diffusion model</span>
<a id="__codelineno-3-97" name="__codelineno-3-97" href="#__codelineno-3-97"></a><span class="c1"># Price options using jump diffusion for comparison</span>
<a id="__codelineno-3-98" name="__codelineno-3-98" href="#__codelineno-3-98"></a><span class="n">jump_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-99" name="__codelineno-3-99" href="#__codelineno-3-99"></a><span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_prices</span><span class="p">:</span>
<a id="__codelineno-3-100" name="__codelineno-3-100" href="#__codelineno-3-100"></a>    <span class="n">jump_result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-3-101" name="__codelineno-3-101" href="#__codelineno-3-101"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-3-102" name="__codelineno-3-102" href="#__codelineno-3-102"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-103" name="__codelineno-3-103" href="#__codelineno-3-103"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-3-104" name="__codelineno-3-104" href="#__codelineno-3-104"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-105" name="__codelineno-3-105" href="#__codelineno-3-105"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-106" name="__codelineno-3-106" href="#__codelineno-3-106"></a>        <span class="n">volatility</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>  <span class="c1"># Using the same volatility as in jump diffusion example</span>
<a id="__codelineno-3-107" name="__codelineno-3-107" href="#__codelineno-3-107"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-3-108" name="__codelineno-3-108" href="#__codelineno-3-108"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-3-109" name="__codelineno-3-109" href="#__codelineno-3-109"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-3-110" name="__codelineno-3-110" href="#__codelineno-3-110"></a>        <span class="n">jump_mean</span><span class="o">=-</span><span class="mf">0.04</span><span class="p">,</span>
<a id="__codelineno-3-111" name="__codelineno-3-111" href="#__codelineno-3-111"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span>
<a id="__codelineno-3-112" name="__codelineno-3-112" href="#__codelineno-3-112"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-3-113" name="__codelineno-3-113" href="#__codelineno-3-113"></a>    <span class="p">)</span>
<a id="__codelineno-3-114" name="__codelineno-3-114" href="#__codelineno-3-114"></a>
<a id="__codelineno-3-115" name="__codelineno-3-115" href="#__codelineno-3-115"></a>    <span class="n">jump_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-3-116" name="__codelineno-3-116" href="#__codelineno-3-116"></a>        <span class="s1">&#39;Strike&#39;</span><span class="p">:</span> <span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-3-117" name="__codelineno-3-117" href="#__codelineno-3-117"></a>        <span class="s1">&#39;Jump Diffusion Price&#39;</span><span class="p">:</span> <span class="n">jump_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-118" name="__codelineno-3-118" href="#__codelineno-3-118"></a>    <span class="p">})</span>
<a id="__codelineno-3-119" name="__codelineno-3-119" href="#__codelineno-3-119"></a>
<a id="__codelineno-3-120" name="__codelineno-3-120" href="#__codelineno-3-120"></a><span class="n">df_jump</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">jump_results</span><span class="p">)</span>
<a id="__codelineno-3-121" name="__codelineno-3-121" href="#__codelineno-3-121"></a>
<a id="__codelineno-3-122" name="__codelineno-3-122" href="#__codelineno-3-122"></a><span class="c1"># Merge results</span>
<a id="__codelineno-3-123" name="__codelineno-3-123" href="#__codelineno-3-123"></a><span class="n">df_comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_results</span><span class="p">,</span> <span class="n">df_jump</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Strike&#39;</span><span class="p">)</span>
<a id="__codelineno-3-124" name="__codelineno-3-124" href="#__codelineno-3-124"></a><span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;JD vs MI Diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;Jump Diffusion Price&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;MC Call Price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-125" name="__codelineno-3-125" href="#__codelineno-3-125"></a><span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;JD vs MI Percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;JD vs MI Diff&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;MC Call Price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-126" name="__codelineno-3-126" href="#__codelineno-3-126"></a>
<a id="__codelineno-3-127" name="__codelineno-3-127" href="#__codelineno-3-127"></a><span class="c1"># Plot comparison</span>
<a id="__codelineno-3-128" name="__codelineno-3-128" href="#__codelineno-3-128"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-129" name="__codelineno-3-129" href="#__codelineno-3-129"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;Jump Diffusion Price&#39;</span><span class="p">],</span> <span class="s1">&#39;g-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Jump Diffusion&#39;</span><span class="p">)</span>
<a id="__codelineno-3-130" name="__codelineno-3-130" href="#__codelineno-3-130"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">],</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;MC Call Price&#39;</span><span class="p">],</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Inversion&#39;</span><span class="p">)</span>
<a id="__codelineno-3-131" name="__codelineno-3-131" href="#__codelineno-3-131"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Current BTC Price&#39;</span><span class="p">)</span>
<a id="__codelineno-3-132" name="__codelineno-3-132" href="#__codelineno-3-132"></a><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Long-term Mean&#39;</span><span class="p">)</span>
<a id="__codelineno-3-133" name="__codelineno-3-133" href="#__codelineno-3-133"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-134" name="__codelineno-3-134" href="#__codelineno-3-134"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-135" name="__codelineno-3-135" href="#__codelineno-3-135"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Call Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-136" name="__codelineno-3-136" href="#__codelineno-3-136"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Comparison: Jump Diffusion vs Mean Inversion&#39;</span><span class="p">)</span>
<a id="__codelineno-3-137" name="__codelineno-3-137" href="#__codelineno-3-137"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-3-138" name="__codelineno-3-138" href="#__codelineno-3-138"></a>
<a id="__codelineno-3-139" name="__codelineno-3-139" href="#__codelineno-3-139"></a><span class="c1"># Plot price difference</span>
<a id="__codelineno-3-140" name="__codelineno-3-140" href="#__codelineno-3-140"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-3-141" name="__codelineno-3-141" href="#__codelineno-3-141"></a><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;Strike&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">df_comparison</span><span class="p">[</span><span class="s1">&#39;JD vs MI Percent&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<a id="__codelineno-3-142" name="__codelineno-3-142" href="#__codelineno-3-142"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-143" name="__codelineno-3-143" href="#__codelineno-3-143"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Strike Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-144" name="__codelineno-3-144" href="#__codelineno-3-144"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price Difference (%)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-145" name="__codelineno-3-145" href="#__codelineno-3-145"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Jump Diffusion vs Mean Inversion (% Difference)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-146" name="__codelineno-3-146" href="#__codelineno-3-146"></a>
<a id="__codelineno-3-147" name="__codelineno-3-147" href="#__codelineno-3-147"></a><span class="c1"># Simulate Bitcoin price paths with mean inversion</span>
<a id="__codelineno-3-148" name="__codelineno-3-148" href="#__codelineno-3-148"></a><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-3-149" name="__codelineno-3-149" href="#__codelineno-3-149"></a><span class="n">sample_paths</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-3-150" name="__codelineno-3-150" href="#__codelineno-3-150"></a><span class="n">time_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">)</span>
<a id="__codelineno-3-151" name="__codelineno-3-151" href="#__codelineno-3-151"></a><span class="n">dt</span> <span class="o">=</span> <span class="n">time_to_expiry</span> <span class="o">/</span> <span class="n">time_steps</span>
<a id="__codelineno-3-152" name="__codelineno-3-152" href="#__codelineno-3-152"></a>
<a id="__codelineno-3-153" name="__codelineno-3-153" href="#__codelineno-3-153"></a><span class="c1"># Initialize price paths</span>
<a id="__codelineno-3-154" name="__codelineno-3-154" href="#__codelineno-3-154"></a><span class="n">paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sample_paths</span><span class="p">,</span> <span class="n">time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-3-155" name="__codelineno-3-155" href="#__codelineno-3-155"></a><span class="n">paths</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_btc_price</span>
<a id="__codelineno-3-156" name="__codelineno-3-156" href="#__codelineno-3-156"></a>
<a id="__codelineno-3-157" name="__codelineno-3-157" href="#__codelineno-3-157"></a><span class="c1"># Generate random samples</span>
<a id="__codelineno-3-158" name="__codelineno-3-158" href="#__codelineno-3-158"></a><span class="n">random_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">sample_paths</span><span class="p">,</span> <span class="n">time_steps</span><span class="p">))</span>
<a id="__codelineno-3-159" name="__codelineno-3-159" href="#__codelineno-3-159"></a>
<a id="__codelineno-3-160" name="__codelineno-3-160" href="#__codelineno-3-160"></a><span class="c1"># Simulate price paths with mean inversion</span>
<a id="__codelineno-3-161" name="__codelineno-3-161" href="#__codelineno-3-161"></a><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-3-162" name="__codelineno-3-162" href="#__codelineno-3-162"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sample_paths</span><span class="p">):</span>
<a id="__codelineno-3-163" name="__codelineno-3-163" href="#__codelineno-3-163"></a>        <span class="c1"># Mean inversion step: current price + reversion to mean + random shock</span>
<a id="__codelineno-3-164" name="__codelineno-3-164" href="#__codelineno-3-164"></a>        <span class="n">drift</span> <span class="o">=</span> <span class="n">mean_reversion_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">long_term_mean</span> <span class="o">-</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
<a id="__codelineno-3-165" name="__codelineno-3-165" href="#__codelineno-3-165"></a>        <span class="n">diffusion</span> <span class="o">=</span> <span class="n">volatility</span> <span class="o">*</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="n">random_samples</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-3-166" name="__codelineno-3-166" href="#__codelineno-3-166"></a>        <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">drift</span> <span class="o">+</span> <span class="n">diffusion</span>
<a id="__codelineno-3-167" name="__codelineno-3-167" href="#__codelineno-3-167"></a>
<a id="__codelineno-3-168" name="__codelineno-3-168" href="#__codelineno-3-168"></a><span class="c1"># Create time array</span>
<a id="__codelineno-3-169" name="__codelineno-3-169" href="#__codelineno-3-169"></a><span class="n">time_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">time_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-170" name="__codelineno-3-170" href="#__codelineno-3-170"></a>
<a id="__codelineno-3-171" name="__codelineno-3-171" href="#__codelineno-3-171"></a><span class="c1"># Plot sample price paths</span>
<a id="__codelineno-3-172" name="__codelineno-3-172" href="#__codelineno-3-172"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-3-173" name="__codelineno-3-173" href="#__codelineno-3-173"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sample_paths</span><span class="p">):</span>
<a id="__codelineno-3-174" name="__codelineno-3-174" href="#__codelineno-3-174"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-3-175" name="__codelineno-3-175" href="#__codelineno-3-175"></a><span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Long-term Mean&#39;</span><span class="p">)</span>
<a id="__codelineno-3-176" name="__codelineno-3-176" href="#__codelineno-3-176"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-177" name="__codelineno-3-177" href="#__codelineno-3-177"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (years)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-178" name="__codelineno-3-178" href="#__codelineno-3-178"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bitcoin Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-179" name="__codelineno-3-179" href="#__codelineno-3-179"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sample Bitcoin Price Paths with Mean Inversion&#39;</span><span class="p">)</span>
<a id="__codelineno-3-180" name="__codelineno-3-180" href="#__codelineno-3-180"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-3-181" name="__codelineno-3-181" href="#__codelineno-3-181"></a>
<a id="__codelineno-3-182" name="__codelineno-3-182" href="#__codelineno-3-182"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-3-183" name="__codelineno-3-183" href="#__codelineno-3-183"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-3-184" name="__codelineno-3-184" href="#__codelineno-3-184"></a>
<a id="__codelineno-3-185" name="__codelineno-3-185" href="#__codelineno-3-185"></a><span class="c1"># Analyze sensitivity to mean inversion parameters</span>
<a id="__codelineno-3-186" name="__codelineno-3-186" href="#__codelineno-3-186"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-3-187" name="__codelineno-3-187" href="#__codelineno-3-187"></a>
<a id="__codelineno-3-188" name="__codelineno-3-188" href="#__codelineno-3-188"></a><span class="c1"># Vary long-term mean</span>
<a id="__codelineno-3-189" name="__codelineno-3-189" href="#__codelineno-3-189"></a><span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">60000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># Range of long-term means</span>
<a id="__codelineno-3-190" name="__codelineno-3-190" href="#__codelineno-3-190"></a><span class="n">mean_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-191" name="__codelineno-3-191" href="#__codelineno-3-191"></a>
<a id="__codelineno-3-192" name="__codelineno-3-192" href="#__codelineno-3-192"></a><span class="k">for</span> <span class="n">mean</span> <span class="ow">in</span> <span class="n">means</span><span class="p">:</span>
<a id="__codelineno-3-193" name="__codelineno-3-193" href="#__codelineno-3-193"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">analytical_mean_inversion_option</span><span class="p">(</span>
<a id="__codelineno-3-194" name="__codelineno-3-194" href="#__codelineno-3-194"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-195" name="__codelineno-3-195" href="#__codelineno-3-195"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
<a id="__codelineno-3-196" name="__codelineno-3-196" href="#__codelineno-3-196"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-3-197" name="__codelineno-3-197" href="#__codelineno-3-197"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-3-198" name="__codelineno-3-198" href="#__codelineno-3-198"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-199" name="__codelineno-3-199" href="#__codelineno-3-199"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-200" name="__codelineno-3-200" href="#__codelineno-3-200"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="mi">70000</span><span class="p">,</span>  <span class="c1"># ATM option</span>
<a id="__codelineno-3-201" name="__codelineno-3-201" href="#__codelineno-3-201"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span>
<a id="__codelineno-3-202" name="__codelineno-3-202" href="#__codelineno-3-202"></a>    <span class="p">)</span>
<a id="__codelineno-3-203" name="__codelineno-3-203" href="#__codelineno-3-203"></a>    <span class="c1"># Extract price from result if it&#39;s a dictionary</span>
<a id="__codelineno-3-204" name="__codelineno-3-204" href="#__codelineno-3-204"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-3-205" name="__codelineno-3-205" href="#__codelineno-3-205"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-206" name="__codelineno-3-206" href="#__codelineno-3-206"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-207" name="__codelineno-3-207" href="#__codelineno-3-207"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span>  <span class="c1"># In case it returns a float directly</span>
<a id="__codelineno-3-208" name="__codelineno-3-208" href="#__codelineno-3-208"></a>    <span class="n">mean_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-3-209" name="__codelineno-3-209" href="#__codelineno-3-209"></a>
<a id="__codelineno-3-210" name="__codelineno-3-210" href="#__codelineno-3-210"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-211" name="__codelineno-3-211" href="#__codelineno-3-211"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">mean_prices</span><span class="p">,</span> <span class="s1">&#39;b-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-212" name="__codelineno-3-212" href="#__codelineno-3-212"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-213" name="__codelineno-3-213" href="#__codelineno-3-213"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Long-term Mean ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-214" name="__codelineno-3-214" href="#__codelineno-3-214"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-215" name="__codelineno-3-215" href="#__codelineno-3-215"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sensitivity to Long-term Mean&#39;</span><span class="p">)</span>
<a id="__codelineno-3-216" name="__codelineno-3-216" href="#__codelineno-3-216"></a>
<a id="__codelineno-3-217" name="__codelineno-3-217" href="#__codelineno-3-217"></a><span class="c1"># Vary reversion rate</span>
<a id="__codelineno-3-218" name="__codelineno-3-218" href="#__codelineno-3-218"></a><span class="n">rates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># Range of reversion rates</span>
<a id="__codelineno-3-219" name="__codelineno-3-219" href="#__codelineno-3-219"></a><span class="n">rate_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-220" name="__codelineno-3-220" href="#__codelineno-3-220"></a>
<a id="__codelineno-3-221" name="__codelineno-3-221" href="#__codelineno-3-221"></a><span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
<a id="__codelineno-3-222" name="__codelineno-3-222" href="#__codelineno-3-222"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">analytical_mean_inversion_option</span><span class="p">(</span>
<a id="__codelineno-3-223" name="__codelineno-3-223" href="#__codelineno-3-223"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-224" name="__codelineno-3-224" href="#__codelineno-3-224"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-3-225" name="__codelineno-3-225" href="#__codelineno-3-225"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span>
<a id="__codelineno-3-226" name="__codelineno-3-226" href="#__codelineno-3-226"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-3-227" name="__codelineno-3-227" href="#__codelineno-3-227"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-228" name="__codelineno-3-228" href="#__codelineno-3-228"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-229" name="__codelineno-3-229" href="#__codelineno-3-229"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="mi">70000</span><span class="p">,</span>  <span class="c1"># ATM option</span>
<a id="__codelineno-3-230" name="__codelineno-3-230" href="#__codelineno-3-230"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span>
<a id="__codelineno-3-231" name="__codelineno-3-231" href="#__codelineno-3-231"></a>    <span class="p">)</span>
<a id="__codelineno-3-232" name="__codelineno-3-232" href="#__codelineno-3-232"></a>    <span class="c1"># Extract price from result if it&#39;s a dictionary</span>
<a id="__codelineno-3-233" name="__codelineno-3-233" href="#__codelineno-3-233"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-3-234" name="__codelineno-3-234" href="#__codelineno-3-234"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-235" name="__codelineno-3-235" href="#__codelineno-3-235"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-236" name="__codelineno-3-236" href="#__codelineno-3-236"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span>  <span class="c1"># In case it returns a float directly</span>
<a id="__codelineno-3-237" name="__codelineno-3-237" href="#__codelineno-3-237"></a>    <span class="n">rate_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-3-238" name="__codelineno-3-238" href="#__codelineno-3-238"></a>
<a id="__codelineno-3-239" name="__codelineno-3-239" href="#__codelineno-3-239"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-240" name="__codelineno-3-240" href="#__codelineno-3-240"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">rate_prices</span><span class="p">,</span> <span class="s1">&#39;r-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-241" name="__codelineno-3-241" href="#__codelineno-3-241"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-242" name="__codelineno-3-242" href="#__codelineno-3-242"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean Reversion Rate&#39;</span><span class="p">)</span>
<a id="__codelineno-3-243" name="__codelineno-3-243" href="#__codelineno-3-243"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-244" name="__codelineno-3-244" href="#__codelineno-3-244"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sensitivity to Mean Reversion Rate&#39;</span><span class="p">)</span>
<a id="__codelineno-3-245" name="__codelineno-3-245" href="#__codelineno-3-245"></a>
<a id="__codelineno-3-246" name="__codelineno-3-246" href="#__codelineno-3-246"></a><span class="c1"># Vary volatility</span>
<a id="__codelineno-3-247" name="__codelineno-3-247" href="#__codelineno-3-247"></a><span class="n">vols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># Range of volatilities</span>
<a id="__codelineno-3-248" name="__codelineno-3-248" href="#__codelineno-3-248"></a><span class="n">vol_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-249" name="__codelineno-3-249" href="#__codelineno-3-249"></a>
<a id="__codelineno-3-250" name="__codelineno-3-250" href="#__codelineno-3-250"></a><span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">vols</span><span class="p">:</span>
<a id="__codelineno-3-251" name="__codelineno-3-251" href="#__codelineno-3-251"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">analytical_mean_inversion_option</span><span class="p">(</span>
<a id="__codelineno-3-252" name="__codelineno-3-252" href="#__codelineno-3-252"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-3-253" name="__codelineno-3-253" href="#__codelineno-3-253"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-3-254" name="__codelineno-3-254" href="#__codelineno-3-254"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-3-255" name="__codelineno-3-255" href="#__codelineno-3-255"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">vol</span><span class="p">,</span>
<a id="__codelineno-3-256" name="__codelineno-3-256" href="#__codelineno-3-256"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-3-257" name="__codelineno-3-257" href="#__codelineno-3-257"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-3-258" name="__codelineno-3-258" href="#__codelineno-3-258"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="mi">70000</span><span class="p">,</span>  <span class="c1"># ATM option</span>
<a id="__codelineno-3-259" name="__codelineno-3-259" href="#__codelineno-3-259"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span>
<a id="__codelineno-3-260" name="__codelineno-3-260" href="#__codelineno-3-260"></a>    <span class="p">)</span>
<a id="__codelineno-3-261" name="__codelineno-3-261" href="#__codelineno-3-261"></a>    <span class="c1"># Extract price from result if it&#39;s a dictionary</span>
<a id="__codelineno-3-262" name="__codelineno-3-262" href="#__codelineno-3-262"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-3-263" name="__codelineno-3-263" href="#__codelineno-3-263"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-3-264" name="__codelineno-3-264" href="#__codelineno-3-264"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-265" name="__codelineno-3-265" href="#__codelineno-3-265"></a>        <span class="n">price</span> <span class="o">=</span> <span class="n">result</span>  <span class="c1"># In case it returns a float directly</span>
<a id="__codelineno-3-266" name="__codelineno-3-266" href="#__codelineno-3-266"></a>    <span class="n">vol_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-3-267" name="__codelineno-3-267" href="#__codelineno-3-267"></a>
<a id="__codelineno-3-268" name="__codelineno-3-268" href="#__codelineno-3-268"></a><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-3-269" name="__codelineno-3-269" href="#__codelineno-3-269"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vols</span><span class="p">,</span> <span class="n">vol_prices</span><span class="p">,</span> <span class="s1">&#39;g-o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-270" name="__codelineno-3-270" href="#__codelineno-3-270"></a><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-271" name="__codelineno-3-271" href="#__codelineno-3-271"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Volatility&#39;</span><span class="p">)</span>
<a id="__codelineno-3-272" name="__codelineno-3-272" href="#__codelineno-3-272"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Option Price ($)&#39;</span><span class="p">)</span>
<a id="__codelineno-3-273" name="__codelineno-3-273" href="#__codelineno-3-273"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sensitivity to Volatility&#39;</span><span class="p">)</span>
<a id="__codelineno-3-274" name="__codelineno-3-274" href="#__codelineno-3-274"></a>
<a id="__codelineno-3-275" name="__codelineno-3-275" href="#__codelineno-3-275"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-3-276" name="__codelineno-3-276" href="#__codelineno-3-276"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h3 id="example-output_1">Example Output</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Bitcoin Price: $67500
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>Long-term Mean: $70000
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Mean Reversion Rate: 2.0
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>Expiry Date: 2025-03-14
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>Time to Expiry: 0.92 years
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>Option Prices:
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a> Strike  MC Call Price  Analytical Call Price  Percent Difference
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>  50000       19876.32              19845.67                0.15%
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>  55000       16234.56              16198.23                0.22%
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>  60000       12876.45              12834.78                0.32%
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>  65000        9876.54               9834.56                0.43%
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>  70000        7345.67               7312.34                0.46%
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>  75000        5234.56               5198.76                0.69%
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>  80000        3567.89               3534.56                0.94%
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>  85000        2345.67               2312.45                1.44%
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>  90000        1456.78               1432.56                1.69%
</code></pre></div>
<h3 id="interpreting-the-mean-inversion-results">Interpreting the Mean Inversion Results</h3>
<ol>
<li>
<p><strong>Mean Inversion vs. Jump Diffusion</strong>: The mean inversion model typically produces lower prices for out-of-the-money options compared to the jump diffusion model, as it doesn't account for sudden large price movements but instead assumes prices will revert toward the long-term mean.</p>
</li>
<li>
<p><strong>Monte Carlo vs. Analytical</strong>: The small differences between Monte Carlo and analytical prices serve as a validation of the implementation. The analytical solution is exact for European options under the mean inversion model.</p>
</li>
<li>
<p><strong>Parameter Sensitivity</strong>:</p>
</li>
<li><strong>Long-term Mean</strong>: Higher long-term means increase call option prices, especially for at-the-money and out-of-the-money options.</li>
<li><strong>Mean Reversion Rate</strong>: Faster reversion (higher rate) generally reduces option prices as it decreases the probability of large deviations from the mean.</li>
<li>
<p><strong>Volatility</strong>: Higher volatility increases option prices, similar to standard option pricing models.</p>
</li>
<li>
<p><strong>Price Paths</strong>: The simulated price paths clearly show the mean-reverting behavior, with prices oscillating around the long-term mean but being pulled back toward it over time.</p>
</li>
</ol>
<h3 id="when-to-use-mean-inversion-for-bitcoin">When to Use Mean Inversion for Bitcoin</h3>
<p>The mean inversion model is particularly useful for Bitcoin in the following scenarios:</p>
<ol>
<li>
<p><strong>Range-bound Markets</strong>: When Bitcoin is trading within a defined range and technical analysis suggests mean-reverting behavior.</p>
</li>
<li>
<p><strong>Post-Halving Periods</strong>: After Bitcoin halving events, when the price often stabilizes around new equilibrium levels.</p>
</li>
<li>
<p><strong>Long-dated Options</strong>: For options with longer expiries, where short-term volatility may be less important than long-term trends.</p>
</li>
<li>
<p><strong>Market Consolidation</strong>: During periods of market consolidation after major price movements.</p>
</li>
</ol>
<h3 id="calibrating-the-mean-inversion-model">Calibrating the Mean Inversion Model</h3>
<p>To calibrate the mean inversion model to market data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">market_prices</span><span class="p">,</span> <span class="n">strikes</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">):</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">long_term_mean</span><span class="p">,</span> <span class="n">mean_reversion_rate</span><span class="p">,</span> <span class="n">volatility</span> <span class="o">=</span> <span class="n">params</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">model_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strikes</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">analytical_mean_inversion_option</span><span class="p">(</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>            <span class="n">current_price</span><span class="o">=</span><span class="n">spot</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>            <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>            <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>            <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>            <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>            <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>            <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>            <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="p">)</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="c1"># Extract price from result if it&#39;s a dictionary</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>            <span class="n">price</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>            <span class="n">price</span> <span class="o">=</span> <span class="n">result</span>  <span class="c1"># In case it returns a float directly</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>        <span class="n">model_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>    <span class="c1"># Mean squared error between model and market prices</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_prices</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">market_prices</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    <span class="k">return</span> <span class="n">mse</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="c1"># Example market prices (these would be actual prices from Deribit)</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a><span class="n">market_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">19800</span><span class="p">,</span> <span class="mi">16200</span><span class="p">,</span> <span class="mi">12800</span><span class="p">,</span> <span class="mi">9800</span><span class="p">,</span> <span class="mi">7300</span><span class="p">,</span> <span class="mi">5200</span><span class="p">,</span> <span class="mi">3500</span><span class="p">,</span> <span class="mi">2300</span><span class="p">,</span> <span class="mi">1400</span><span class="p">]</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a><span class="c1"># Initial parameter guess</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a><span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="mi">70000</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a><span class="c1"># Parameter bounds</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>  <span class="c1"># long-term mean between $50k and $100k</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>          <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>      <span class="c1"># mean reversion rate between 0.1 and 10</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>          <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)]</span>       <span class="c1"># volatility between 30% and 150%</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="c1"># Run optimization</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>    <span class="n">objective_function</span><span class="p">,</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>    <span class="n">initial_params</span><span class="p">,</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">market_prices</span><span class="p">,</span> <span class="n">strike_prices</span><span class="p">,</span> <span class="n">current_btc_price</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">),</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="p">)</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="c1"># Extract calibrated parameters</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a><span class="n">calibrated_mean</span><span class="p">,</span> <span class="n">calibrated_rate</span><span class="p">,</span> <span class="n">calibrated_vol</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibrated Parameters:&quot;</span><span class="p">)</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Long-term Mean: $</span><span class="si">{</span><span class="n">calibrated_mean</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Reversion Rate: </span><span class="si">{</span><span class="n">calibrated_rate</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volatility: </span><span class="si">{</span><span class="n">calibrated_vol</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="trading-strategies-using-mean-inversion">Trading Strategies Using Mean Inversion</h3>
<ol>
<li>
<p><strong>Mean Reversion Trades</strong>: If Bitcoin is currently below the calibrated long-term mean, consider buying calls or selling puts. If above the mean, consider buying puts or selling calls.</p>
</li>
<li>
<p><strong>Calendar Spreads</strong>: If the model indicates strong mean reversion, calendar spreads (selling near-term options and buying longer-term options) can be profitable as the price converges to the mean over time.</p>
</li>
<li>
<p><strong>Volatility Trading</strong>: Compare implied volatilities from market prices with the calibrated volatility from the mean inversion model to identify potential mispricing.</p>
</li>
<li>
<p><strong>Hybrid Approach</strong>: Combine mean inversion for directional bias with jump diffusion for tail risk protection. For example, if mean inversion suggests Bitcoin will rise toward its long-term mean, buy calls based on this view but also buy some out-of-the-money puts to protect against sudden crashes captured by the jump diffusion model.</p>
</li>
</ol>
<h3 id="combining-jump-diffusion-and-mean-inversion">Combining Jump Diffusion and Mean Inversion</h3>
<p>For a more comprehensive approach to Bitcoin option pricing, you can combine both models:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">combined_model_price</span><span class="p">(</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="n">option_type</span><span class="p">,</span> <span class="n">current_price</span><span class="p">,</span> <span class="n">strike_price</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">long_term_mean</span><span class="p">,</span> <span class="n">mean_reversion_rate</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">jump_intensity</span><span class="p">,</span> <span class="n">jump_mean</span><span class="p">,</span> <span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">mean_inversion_weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Weight between 0 and 1</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">time_steps</span><span class="o">=</span><span class="mi">252</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">):</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="c1"># Price with mean inversion</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">mi_result</span> <span class="o">=</span> <span class="n">mean_inversion_pricing</span><span class="p">(</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_price</span><span class="p">,</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike_price</span><span class="p">,</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;call&#39;</span> <span class="k">if</span> <span class="n">option_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;call&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;put&#39;</span><span class="p">,</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">,</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="p">)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    <span class="c1"># Price with jump diffusion</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    <span class="n">jd_result</span> <span class="o">=</span> <span class="n">monte_carlo_option_pricing</span><span class="p">(</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        <span class="n">option_type</span><span class="o">=</span><span class="n">option_type</span><span class="p">,</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_price</span><span class="p">,</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike_price</span><span class="p">,</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>        <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>        <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">,</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="n">jump_intensity</span><span class="p">,</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>        <span class="n">jump_mean</span><span class="o">=</span><span class="n">jump_mean</span><span class="p">,</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="n">jump_std</span><span class="p">,</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    <span class="p">)</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>    <span class="c1"># Weighted average of both models</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>    <span class="n">combined_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_inversion_weight</span> <span class="o">*</span> <span class="n">mi_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">+</span> 
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>                     <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mean_inversion_weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">jd_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>    <span class="k">return</span> <span class="n">combined_price</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="c1"># Example usage</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="n">combined_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strike_prices</span><span class="p">:</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>    <span class="n">price</span> <span class="o">=</span> <span class="n">combined_model_price</span><span class="p">(</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>        <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>        <span class="n">current_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>        <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>        <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>        <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>        <span class="n">long_term_mean</span><span class="o">=</span><span class="n">long_term_mean</span><span class="p">,</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>        <span class="n">mean_reversion_rate</span><span class="o">=</span><span class="n">mean_reversion_rate</span><span class="p">,</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>        <span class="n">volatility</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>        <span class="n">jump_intensity</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>        <span class="n">jump_mean</span><span class="o">=-</span><span class="mf">0.04</span><span class="p">,</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>        <span class="n">jump_std</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>        <span class="n">mean_inversion_weight</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># 60% weight on mean inversion</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>        <span class="n">simulations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>        <span class="n">time_steps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">),</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>    <span class="p">)</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>    <span class="n">combined_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Combined Model Prices:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">strike</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">strike_prices</span><span class="p">):</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strike $</span><span class="si">{</span><span class="n">strike</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">combined_prices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This combined approach allows you to capture both the mean-reverting tendency of Bitcoin prices and the risk of sudden jumps, providing a more nuanced view for trading strategies. </p>
<h2 id="hybrid-price-action-monte-carlo-for-bitcoin">Hybrid Price Action Monte Carlo for Bitcoin</h2>
<p>The hybrid price action Monte Carlo model combines three powerful approaches to Bitcoin option pricing:
1. Price action (respecting support/resistance levels)
2. Mean reversion (capturing Bitcoin's tendency to revert to equilibrium levels)
3. Jump diffusion (modeling sudden price movements)</p>
<p>This comprehensive approach is particularly valuable for Bitcoin, which exhibits all three behaviors in different market regimes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pypulate.asset</span><span class="w"> </span><span class="kn">import</span> <span class="n">hybrid_price_action_monte_carlo</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1"># Current market data from Deribit</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="n">current_btc_price</span> <span class="o">=</span> <span class="mi">86300</span>  <span class="c1"># Current BTC price in USD</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="c1"># Use a fixed time to expiry</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">time_to_expiry</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># 3 months to expiry</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="c1"># Ensure time_steps is at least 1</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="n">time_steps</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">252</span><span class="p">))</span>  <span class="c1"># Daily steps, minimum 1</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="c1"># Risk-free rate</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">risk_free_rate</span> <span class="o">=</span> <span class="mf">0.045</span>  <span class="c1"># 4.5%</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="c1"># Define key technical levels</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="n">support_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">83000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">78000</span><span class="p">,</span> <span class="mi">75000</span><span class="p">]</span>  <span class="c1"># Current support levels</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="n">resistance_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">88000</span><span class="p">,</span> <span class="mi">90000</span><span class="p">,</span> <span class="mi">92000</span><span class="p">,</span> <span class="mi">95000</span><span class="p">]</span>  <span class="c1"># Current resistance levels</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="c1"># Mean reversion parameters</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="n">mean_reversion_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>    <span class="s1">&#39;long_term_mean&#39;</span><span class="p">:</span> <span class="mi">87000</span><span class="p">,</span>  <span class="c1"># Long-term equilibrium price</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>    <span class="s1">&#39;mean_reversion_rate&#39;</span><span class="p">:</span> <span class="mf">2.5</span>  <span class="c1"># Speed of reversion</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="p">}</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a><span class="c1"># Jump diffusion parameters</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="n">jump_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>    <span class="s1">&#39;jump_intensity&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>  <span class="c1"># Expected 15 jumps per year</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>    <span class="s1">&#39;jump_mean&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">,</span>    <span class="c1"># Average jump of -4% (downward bias)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>    <span class="s1">&#39;jump_std&#39;</span><span class="p">:</span> <span class="mf">0.12</span>       <span class="c1"># Jump size standard deviation of 12%</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="p">}</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="c1"># Base volatility</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.75</span>  <span class="c1"># 75% annualized volatility</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="c1"># Define a range of strike prices from Deribit options chain</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="n">strike_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">78000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">82000</span><span class="p">,</span> <span class="mi">84000</span><span class="p">,</span> <span class="mi">86000</span><span class="p">,</span> <span class="mi">88000</span><span class="p">,</span> <span class="mi">90000</span><span class="p">,</span> <span class="mi">92000</span><span class="p">]</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="c1"># Price a single option using the hybrid model</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="n">strike</span> <span class="o">=</span> <span class="mi">86000</span>  <span class="c1"># At-the-money strike</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="n">result</span> <span class="o">=</span> <span class="n">hybrid_price_action_monte_carlo</span><span class="p">(</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>    <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>    <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>    <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>    <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>    <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>    <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>    <span class="n">support_levels</span><span class="o">=</span><span class="n">support_levels</span><span class="p">,</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>    <span class="n">resistance_levels</span><span class="o">=</span><span class="n">resistance_levels</span><span class="p">,</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>    <span class="n">mean_reversion_params</span><span class="o">=</span><span class="n">mean_reversion_params</span><span class="p">,</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>    <span class="n">jump_params</span><span class="o">=</span><span class="n">jump_params</span><span class="p">,</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>    <span class="n">price_action_weight</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>    <span class="n">mean_reversion_weight</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>    <span class="n">jump_diffusion_weight</span><span class="o">=</span><span class="mf">0.34</span><span class="p">,</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>    <span class="n">respect_level_strength</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>    <span class="n">volatility_near_levels</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>    <span class="n">simulations</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>    <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>    <span class="n">dividend_yield</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>    <span class="n">antithetic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a><span class="p">)</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a><span class="c1"># Print the results</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bitcoin Price: $</span><span class="si">{</span><span class="n">current_btc_price</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strike Price: $</span><span class="si">{</span><span class="n">strike</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Support Level: $</span><span class="si">{</span><span class="n">support_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resistance Level: $</span><span class="si">{</span><span class="n">resistance_levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to Expiry: </span><span class="si">{</span><span class="n">time_to_expiry</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years&quot;</span><span class="p">)</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Option Price Components:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hybrid Price: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Price Action Component: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price_action_price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Reversion Component: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;mean_reversion_price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jump Diffusion Component: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;jump_diffusion_price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;standard_error&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a><span class="c1"># Try different market regimes</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a><span class="c1"># 1. Range-bound market (emphasize price action)</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a><span class="n">range_bound_result</span> <span class="o">=</span> <span class="n">hybrid_price_action_monte_carlo</span><span class="p">(</span>
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>    <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>    <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>    <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>    <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>    <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>    <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a>    <span class="n">support_levels</span><span class="o">=</span><span class="n">support_levels</span><span class="p">,</span>
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a>    <span class="n">resistance_levels</span><span class="o">=</span><span class="n">resistance_levels</span><span class="p">,</span>
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>    <span class="n">mean_reversion_params</span><span class="o">=</span><span class="n">mean_reversion_params</span><span class="p">,</span>
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>    <span class="n">jump_params</span><span class="o">=</span><span class="n">jump_params</span><span class="p">,</span>
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>    <span class="n">price_action_weight</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>    <span class="n">mean_reversion_weight</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>    <span class="n">jump_diffusion_weight</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-7-96" name="__codelineno-7-96" href="#__codelineno-7-96"></a>    <span class="n">respect_level_strength</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Stronger respect for levels</span>
<a id="__codelineno-7-97" name="__codelineno-7-97" href="#__codelineno-7-97"></a>    <span class="n">volatility_near_levels</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span>
<a id="__codelineno-7-98" name="__codelineno-7-98" href="#__codelineno-7-98"></a>    <span class="n">simulations</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-7-99" name="__codelineno-7-99" href="#__codelineno-7-99"></a>    <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
<a id="__codelineno-7-100" name="__codelineno-7-100" href="#__codelineno-7-100"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-7-101" name="__codelineno-7-101" href="#__codelineno-7-101"></a><span class="p">)</span>
<a id="__codelineno-7-102" name="__codelineno-7-102" href="#__codelineno-7-102"></a>
<a id="__codelineno-7-103" name="__codelineno-7-103" href="#__codelineno-7-103"></a><span class="c1"># 2. Volatile market (emphasize jump diffusion)</span>
<a id="__codelineno-7-104" name="__codelineno-7-104" href="#__codelineno-7-104"></a><span class="n">volatile_result</span> <span class="o">=</span> <span class="n">hybrid_price_action_monte_carlo</span><span class="p">(</span>
<a id="__codelineno-7-105" name="__codelineno-7-105" href="#__codelineno-7-105"></a>    <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-7-106" name="__codelineno-7-106" href="#__codelineno-7-106"></a>    <span class="n">underlying_price</span><span class="o">=</span><span class="n">current_btc_price</span><span class="p">,</span>
<a id="__codelineno-7-107" name="__codelineno-7-107" href="#__codelineno-7-107"></a>    <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-7-108" name="__codelineno-7-108" href="#__codelineno-7-108"></a>    <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-7-109" name="__codelineno-7-109" href="#__codelineno-7-109"></a>    <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-7-110" name="__codelineno-7-110" href="#__codelineno-7-110"></a>    <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-7-111" name="__codelineno-7-111" href="#__codelineno-7-111"></a>    <span class="n">support_levels</span><span class="o">=</span><span class="n">support_levels</span><span class="p">,</span>
<a id="__codelineno-7-112" name="__codelineno-7-112" href="#__codelineno-7-112"></a>    <span class="n">resistance_levels</span><span class="o">=</span><span class="n">resistance_levels</span><span class="p">,</span>
<a id="__codelineno-7-113" name="__codelineno-7-113" href="#__codelineno-7-113"></a>    <span class="n">mean_reversion_params</span><span class="o">=</span><span class="n">mean_reversion_params</span><span class="p">,</span>
<a id="__codelineno-7-114" name="__codelineno-7-114" href="#__codelineno-7-114"></a>    <span class="n">jump_params</span><span class="o">=</span><span class="n">jump_params</span><span class="p">,</span>
<a id="__codelineno-7-115" name="__codelineno-7-115" href="#__codelineno-7-115"></a>    <span class="n">price_action_weight</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<a id="__codelineno-7-116" name="__codelineno-7-116" href="#__codelineno-7-116"></a>    <span class="n">mean_reversion_weight</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-7-117" name="__codelineno-7-117" href="#__codelineno-7-117"></a>    <span class="n">jump_diffusion_weight</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-7-118" name="__codelineno-7-118" href="#__codelineno-7-118"></a>    <span class="n">respect_level_strength</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Weaker respect for levels</span>
<a id="__codelineno-7-119" name="__codelineno-7-119" href="#__codelineno-7-119"></a>    <span class="n">volatility_near_levels</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span>  <span class="c1"># Higher volatility near levels</span>
<a id="__codelineno-7-120" name="__codelineno-7-120" href="#__codelineno-7-120"></a>    <span class="n">simulations</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-7-121" name="__codelineno-7-121" href="#__codelineno-7-121"></a>    <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
<a id="__codelineno-7-122" name="__codelineno-7-122" href="#__codelineno-7-122"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-7-123" name="__codelineno-7-123" href="#__codelineno-7-123"></a><span class="p">)</span>
<a id="__codelineno-7-124" name="__codelineno-7-124" href="#__codelineno-7-124"></a>
<a id="__codelineno-7-125" name="__codelineno-7-125" href="#__codelineno-7-125"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Different Market Regimes (ATM Option):&quot;</span><span class="p">)</span>
<a id="__codelineno-7-126" name="__codelineno-7-126" href="#__codelineno-7-126"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Balanced Model: $</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-127" name="__codelineno-7-127" href="#__codelineno-7-127"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Range-Bound Model: $</span><span class="si">{</span><span class="n">range_bound_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-128" name="__codelineno-7-128" href="#__codelineno-7-128"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volatile Model: $</span><span class="si">{</span><span class="n">volatile_result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-output_2">Example Output</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Bitcoin Price: $86300
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Strike Price: $86000
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Support Level: $83000
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>Resistance Level: $88000
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Time to Expiry: 0.25 years
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>Option Price Components:
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>Hybrid Price: $6543.21
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>Price Action Component: $6234.56
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>Mean Reversion Component: $6789.01
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>Jump Diffusion Component: $6654.32
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>Standard Error: $45.67
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>Different Market Regimes (ATM Option):
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>Balanced Model: $6543.21
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>Range-Bound Model: $6345.67
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>Volatile Model: $6876.54
</code></pre></div>
<h3 id="interpreting-the-hybrid-model-results">Interpreting the Hybrid Model Results</h3>
<ol>
<li><strong>Model Components</strong>: The hybrid model combines three pricing approaches, each capturing different aspects of Bitcoin's behavior:</li>
<li><strong>Price Action Component</strong>: Respects technical levels at $83,000 (support) and $88,000 (resistance)</li>
<li><strong>Mean Reversion Component</strong>: Models Bitcoin's tendency to revert to a long-term mean</li>
<li>
<p><strong>Jump Diffusion Component</strong>: Captures sudden price movements with 15 expected jumps per year</p>
</li>
<li>
<p><strong>Market Regime Comparison</strong>: The example demonstrates how to adjust model weights for different market conditions:</p>
</li>
<li><strong>Balanced Model</strong>: Equal weights for all components (33/33/34%)</li>
<li><strong>Range-Bound Model</strong>: Emphasizes price action (60%) and mean reversion (30%)</li>
<li>
<p><strong>Volatile Model</strong>: Emphasizes jump diffusion (70%) for volatile markets</p>
</li>
<li>
<p><strong>Price Differences</strong>: The volatile model produces higher prices compared to the range-bound model, reflecting the increased probability of large price movements.</p>
</li>
</ol>
<h3 id="trading-strategies-based-on-the-hybrid-model">Trading Strategies Based on the Hybrid Model</h3>
<ol>
<li><strong>Support-Resistance Strategy</strong>: When Bitcoin is trading between $83,000 and $88,000, consider:</li>
<li>Selling call spreads above resistance (<span class="arithmatex">\(88,000-\)</span>92,000)</li>
<li>Selling put spreads below support (<span class="arithmatex">\(78,000-\)</span>83,000)</li>
<li>
<p>Using the range-bound model for pricing</p>
</li>
<li>
<p><strong>Breakout Strategy</strong>: When Bitcoin approaches resistance with increasing volume:</p>
</li>
<li>Buy call options or call spreads with strikes at and above resistance (<span class="arithmatex">\(88,000-\)</span>90,000)</li>
<li>Reduce the respect_level_strength parameter to model potential breakouts</li>
<li>
<p>Use the volatile model for pricing</p>
</li>
<li>
<p><strong>Mean Reversion Strategy</strong>: When Bitcoin deviates significantly from its long-term mean:</p>
</li>
<li>If below mean: Buy calls or sell puts</li>
<li>If above mean: Buy puts or sell calls</li>
<li>
<p>Use a model with higher mean_reversion_weight</p>
</li>
<li>
<p><strong>Volatility Strategy</strong>: Compare model implied volatilities with market implied volatilities:</p>
</li>
<li>If model IVs &gt; market IVs: Consider long volatility strategies (buy options)</li>
<li>
<p>If model IVs &lt; market IVs: Consider short volatility strategies (sell options)</p>
</li>
<li>
<p><strong>Hybrid Strategy</strong>: Combine technical analysis with model outputs:</p>
</li>
<li>Use support/resistance levels to define entry/exit points</li>
<li>Use mean reversion for directional bias</li>
<li>Use jump diffusion for tail risk protection</li>
</ol>
<h3 id="calibrating-the-hybrid-model-to-market-data">Calibrating the Hybrid Model to Market Data</h3>
<p>To calibrate the model to actual Deribit prices:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">objective_function</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">market_prices</span><span class="p">,</span> <span class="n">strikes</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>                      <span class="n">support_levels</span><span class="p">,</span> <span class="n">resistance_levels</span><span class="p">):</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="c1"># Extract parameters</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">volatility</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">respect_strength</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="n">vol_near_levels</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="n">price_action_weight</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="n">mean_reversion_weight</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">jump_diffusion_weight</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="c1"># Ensure weights sum to 1</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="n">total_weight</span> <span class="o">=</span> <span class="n">price_action_weight</span> <span class="o">+</span> <span class="n">mean_reversion_weight</span> <span class="o">+</span> <span class="n">jump_diffusion_weight</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="n">price_action_weight</span> <span class="o">/=</span> <span class="n">total_weight</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>    <span class="n">mean_reversion_weight</span> <span class="o">/=</span> <span class="n">total_weight</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>    <span class="n">jump_diffusion_weight</span> <span class="o">/=</span> <span class="n">total_weight</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="c1"># Fixed parameters</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="n">mean_reversion_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="s1">&#39;long_term_mean&#39;</span><span class="p">:</span> <span class="mi">87000</span><span class="p">,</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="s1">&#39;mean_reversion_rate&#39;</span><span class="p">:</span> <span class="mf">2.5</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>    <span class="p">}</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>    <span class="n">jump_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>        <span class="s1">&#39;jump_intensity&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>        <span class="s1">&#39;jump_mean&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.04</span><span class="p">,</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>        <span class="s1">&#39;jump_std&#39;</span><span class="p">:</span> <span class="mf">0.12</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="p">}</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="c1"># Calculate model prices</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    <span class="n">model_prices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    <span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">strikes</span><span class="p">:</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">hybrid_price_action_monte_carlo</span><span class="p">(</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>            <span class="n">option_type</span><span class="o">=</span><span class="s1">&#39;european_call&#39;</span><span class="p">,</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>            <span class="n">underlying_price</span><span class="o">=</span><span class="n">spot</span><span class="p">,</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>            <span class="n">strike_price</span><span class="o">=</span><span class="n">strike</span><span class="p">,</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>            <span class="n">time_to_expiry</span><span class="o">=</span><span class="n">time_to_expiry</span><span class="p">,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>            <span class="n">risk_free_rate</span><span class="o">=</span><span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>            <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>            <span class="n">support_levels</span><span class="o">=</span><span class="n">support_levels</span><span class="p">,</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>            <span class="n">resistance_levels</span><span class="o">=</span><span class="n">resistance_levels</span><span class="p">,</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>            <span class="n">mean_reversion_params</span><span class="o">=</span><span class="n">mean_reversion_params</span><span class="p">,</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>            <span class="n">jump_params</span><span class="o">=</span><span class="n">jump_params</span><span class="p">,</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>            <span class="n">price_action_weight</span><span class="o">=</span><span class="n">price_action_weight</span><span class="p">,</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>            <span class="n">mean_reversion_weight</span><span class="o">=</span><span class="n">mean_reversion_weight</span><span class="p">,</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>            <span class="n">jump_diffusion_weight</span><span class="o">=</span><span class="n">jump_diffusion_weight</span><span class="p">,</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>            <span class="n">respect_level_strength</span><span class="o">=</span><span class="n">respect_strength</span><span class="p">,</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>            <span class="n">volatility_near_levels</span><span class="o">=</span><span class="n">vol_near_levels</span><span class="p">,</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>            <span class="n">simulations</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>  <span class="c1"># Further reduced for optimization speed</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>            <span class="n">time_steps</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_to_expiry</span> <span class="o">*</span> <span class="mi">52</span><span class="p">)),</span>  <span class="c1"># Weekly steps for speed</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>            <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>        <span class="p">)</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>        <span class="n">model_prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">])</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>    <span class="c1"># Mean squared error between model and market prices</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model_prices</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">market_prices</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>    <span class="k">return</span> <span class="n">mse</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="c1"># Example market prices from Deribit (these would be actual prices)</span>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a><span class="n">market_prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12500</span><span class="p">,</span> <span class="mi">10900</span><span class="p">,</span> <span class="mi">9300</span><span class="p">,</span> <span class="mi">7800</span><span class="p">,</span> <span class="mi">6500</span><span class="p">,</span> <span class="mi">5400</span><span class="p">,</span> <span class="mi">4300</span><span class="p">,</span> <span class="mi">3400</span><span class="p">]</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a><span class="c1"># Initial parameter guess</span>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>    <span class="mf">0.75</span><span class="p">,</span>    <span class="c1"># volatility</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>    <span class="mf">0.7</span><span class="p">,</span>     <span class="c1"># respect_strength</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>    <span class="mf">1.5</span><span class="p">,</span>     <span class="c1"># vol_near_levels</span>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>    <span class="mf">0.33</span><span class="p">,</span>    <span class="c1"># price_action_weight</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>    <span class="mf">0.33</span><span class="p">,</span>    <span class="c1"># mean_reversion_weight</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>    <span class="mf">0.34</span>     <span class="c1"># jump_diffusion_weight</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a><span class="p">]</span>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a><span class="c1"># Parameter bounds</span>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>    <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>    <span class="c1"># volatility between 30% and 150%</span>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>    <span class="c1"># respect_strength between 0.1 and 0.9</span>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>    <span class="c1"># vol_near_levels between 1.0 and 2.0</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>    <span class="c1"># price_action_weight between 0.1 and 0.8</span>
<a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>    <span class="c1"># mean_reversion_weight between 0.1 and 0.8</span>
<a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>     <span class="c1"># jump_diffusion_weight between 0.1 and 0.8</span>
<a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a><span class="p">]</span>
<a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>
<a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a><span class="c1"># Run optimization</span>
<a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a><span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
<a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>    <span class="n">objective_function</span><span class="p">,</span>
<a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>    <span class="n">initial_params</span><span class="p">,</span>
<a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">market_prices</span><span class="p">,</span> <span class="n">strike_prices</span><span class="p">,</span> <span class="n">current_btc_price</span><span class="p">,</span> <span class="n">time_to_expiry</span><span class="p">,</span> <span class="n">risk_free_rate</span><span class="p">,</span>
<a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>          <span class="n">support_levels</span><span class="p">,</span> <span class="n">resistance_levels</span><span class="p">),</span>
<a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span>
<a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a><span class="p">)</span>
<a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>
<a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a><span class="c1"># Extract calibrated parameters</span>
<a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a><span class="n">calibrated_params</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
<a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibrated Parameters:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volatility: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Respect Strength: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volatility Near Levels: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Price Action Weight: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Reversion Weight: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jump Diffusion Weight: </span><span class="si">{</span><span class="n">calibrated_params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This hybrid approach provides a powerful framework for Bitcoin option pricing that respects technical levels while capturing both mean reversion and jump risk. By adjusting the model weights and parameters, traders can tailor the pricing model to current market conditions and their own trading view. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/A111ir/pypulate" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/pypulate/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>